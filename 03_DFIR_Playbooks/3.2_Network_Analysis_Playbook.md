# 3.2 Network Forensics Playbook (Universal)

> **Goal:** Reconstruct attack chains through traffic analysis to identify initial access, C2 communication, and data exfiltration.
> **Role:** SOC Analyst.
> **Output:** True Source/Attacker IP, Malicious Payloads, C2 Domains/IPs, and Exfiltration Volume.

---

## Phase 1: Traffic Triage & Asset Identification
*Determine the environment baseline and identify "Top Talkers" before deep-packet inspection.*

### 1. Protocol Hierarchy & Statistics
* **Action:** Identify the distribution of protocols to spot anomalies (e.g., unexpected FTP or SMB in a DMZ).
* **Tool Vault Link:** Use [`6.6_Network_Traffic_Analysis`](../06_Tool_Command_Vault/6.6_Network_Traffic_Analysis.md) for Tshark protocol summary commands.
* **Filter:** Wireshark -> Statistics -> Protocol Hierarchy.

### 2. Conversation & Load Analysis
* **Action:** Identify high-volume sessions that may indicate data exfiltration.
* **Tool Vault Link:** Execute `tshark -z conv,ip` to find Top Talkers.
* **Logic:** If $A \rightarrow B$ bytes are significantly higher than $B \rightarrow A$, investigate for unauthorized data transfer.

---

## Phase 2: Attack Vector Analysis
*Identify how the adversary gained entry or performed reconnaissance.*

### 1. HTTP/Web Audit
* **Recon Check:** Use [`1.3_Network_Protocol_Filters`](../01_Hunting_Cheatsheets/1.3_Network_Protocol_Filters.csv) to filter `http.response.code == 404` for directory brute-forcing.
* **Exploit Check:** Filter for `POST` requests to `.php` or `.jsp` files to find webshell uploads.
* **Tool Check:** Search for automated scanners in `http.user_agent` (e.g., `sqlmap`, `nmap`).

### 2. Authentication & Brute Force
* **Action:** Monitor for credential harvesting or brute force attacks.
* **Filter:** Use `ftp.response.code == 530` for failed logins followed by `230` for success.
* **Documentation:** Record targeted usernames in [`7.2_Evidence_Artifact_Log`](../07_Reporting_Templates/7.2_Evidence_Artifact_Log.csv).

---

## Phase 3: Payload Extraction & C2 Tracking
*Extract malicious artifacts and identify command-and-control infrastructure.*

### 1. Artifact Recovery (Carving)
* **Action:** Reconstruct files transferred over HTTP, SMB, or FTP.
* **Tool Vault Link:** Use [`6.6_Network_Traffic_Analysis`](../06_Tool_Command_Vault/6.6_Network_Traffic_Analysis.md) for **NetworkMiner** automated extraction or Wireshark `Export Objects`.
* **Integrity:** Calculate SHA256 immediately using [`6.1_General_DFIR_Commands`](../06_Tool_Command_Vault/6.1_General_DFIR_Commands.md).

### 2. C2 & Beaconing Detection
* **DNS Audit:** Check for long subdomains or TXT records using `dns.qry.type == 16`.
* **TLS Inspection:** Use `tls.handshake.extensions_server_name` to identify encrypted C2 domains via SNI.
* **Jitter Analysis:** Check for consistent "Time Delta" between packets to confirm automated beacons.

---

## Phase 4: Containment & Reporting
*Close the loop and update defensive controls.*

### 1. Artifact Documentation
* **Evidence Log:** Ensure all malicious IPs, Domains, and Hashes are in [`7.2_Evidence_Artifact_Log`](../07_Reporting_Templates/7.2_Evidence_Artifact_Log.csv).
* **Timeline:** Log all attacker actions and defender remediation in [`7.1_Timeline_Tracker`](../07_Reporting_Templates/7.1_Timeline_Tracker.csv).

### 2. Strategic Hardening
* **Detection:** Convert found TTPs into rules within [`02_Detection_Rules`](../02_Detection_Rules/).
* **Verification:** Cross-reference network findings with host-side logs (e.g., Sysmon Event 1 or 11) using [`1.1_Master_Hunting_Matrix`](../01_Hunting_Cheatsheets/1.1_Master_Hunting_Matrix.csv).

---

## ðŸ” Analytical QA (Self-Check)
* **[ ]** Did I confirm the system timezone via [`1.4_Forensics_Artifacts_Map`](../01_Hunting_Cheatsheets/1.4_Forensics_Artifacts_Map.csv) to align the PCAP with host logs?
* **[ ]** Have I distinguished between legitimate automated traffic and adversary C2?
* **[ ]** If the PCAP is >500MB, did I use [`6.6`](../06_Tool_Command_Vault/6.6_Network_Traffic_Analysis.md) Tshark commands for initial slicing?
* **[ ]** Are all extracted payloads hashed and recorded for Chain of Custody?