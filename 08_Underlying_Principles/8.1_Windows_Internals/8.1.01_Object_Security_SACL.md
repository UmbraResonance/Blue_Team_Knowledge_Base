# Object Security & SACL (System Access Control List)

> **Core Concept:** While DACLs (Discretionary Access Control Lists) determine **Access**, SACLs determine **Visibility** and **Auditing**.
> **Blue Team Impact:** SACL manipulation is a high-fidelity indicator for **Defense Evasion (T1562.002)**.

---

## 1. Technical Architecture

In the Windows Security Model, every securable object (File, Registry, Process, AD Object, etc.) contains a **Security Descriptor**. The ACL is the specific component within this descriptor that defines the interaction between Subjects and Objects.

### **1.1 The Audit Check Workflow**
1.  **Subject Initiation:** A user or process (Subject) attempts an action (e.g., Read/Write) on an Object.
2.  **Access Token Evaluation:** The Windows Kernel compares the Subject's **Access Token** against the Object's **ACL** entries (ACEs).
3.  **Event Generation:** * If the action matches a SACL entry (Success/Failure), **Event ID 4663** is generated.
    * If the SACL itself is modified, **Event ID 4907** is generated.

### **1.2 ACL Components: DACL vs. SACL**
The Access Control List is divided into two operational layers with distinct functional roles:

* **DACL (Discretionary Access Control List)**:
    * **Role**: Governs **Access Rights**—who is permitted or denied access to the object.
    * **Management**: Controlled by the object's Owner.
    * **Blue Team Impact**: Misconfigured DACLs on high-value objects (like GPOs) are a primary vector for **Privilege Escalation (TA0004)**. Unauthorized `GenericWrite` permissions can create "Shadow Admins".
* **SACL (System Access Control List)**:
    * **Role**: Governs **Visibility & Auditing**—which access attempts generate an audit record.
    * **Management**: Controlled by the system security policy; modification requires `SeSecurityPrivilege`.
    * **Blue Team Impact**: SACL manipulation indicates **Defense Evasion (T1562.002)**, where an attacker "silences" an object to avoid detection.

---

## 2. Cross-Domain ACL Governance: AD vs. Local

ACLs operate as a universal security language across both Active Directory and local host environments:

### **2.1 Active Directory (Logical Object ACLs)**
* **Scope**: Objects stored in the `ntds.dit` database (e.g., User, Computer, GroupPolicyContainer).
* **Governance**: Focuses on directory-level permissions, such as who can reset passwords or modify a GPO's `gPCFileSysPath` attribute.
* **Telemetry**: Captured via **Event ID 5136** (Directory Service Object Modified).

### **2.2 Local Host (Physical Resource ACLs)**
* **Scope**: Local system resources (e.g., NTFS files, Registry keys, Services, Processes).
* **Governance**: Focuses on direct resource access, such as reading the `SAM` database or modifying files in `SYSVOL`.
* **Telemetry**: Captured via **Event ID 4670** (Permissions on an object were changed).

### **2.3 The "Co-Management" & GPO Integration**
* **Identity vs. Resource**: Active Directory manages the "Identity" (SIDs), while the Local Host manages the "Resource" (the ACL entry referencing those SIDs).
* **GPO Orchestration**: Group Policy bridges the two by allowing AD-level logical configurations to push and overwrite local ACL settings across the domain, ensuring centralized security enforcement.

### **2.4 Remote Access Hierarchy (The Intersection)**
* **Logic**: When accessing objects over a network (e.g., SMB Share), Windows evaluates two separate ACLs.
* **Evaluation**: Final Access = Intersection of (Share ACL AND NTFS DACL).
* **Blue Team Note**: If an attacker gains Full Control in NTFS but the Share is Read-Only, the compromise remains contained. However, misconfigured "Everyone: Full Control" on Shares is a common detection target.

---

## 3. SDDL Syntax (SACL Focus)

When analyzing **Event 4907**, the modification is recorded in **Security Descriptor Definition Language (SDDL)** format.

**SACL Component Structure:** `S:(AU;[Flags];[Mask];;;[SID])`

| Component | Code | Description | Blue Team Significance |
| :--- | :--- | :--- | :--- |
| **Audit Type** | `AU` | Audit | Standard audit entry indicator. |
| **Audit Flags** | `SA` | Success | Logs successful attempts. |
| **Audit Flags** | `FA` | Failure | Logs failed attempts (Key for brute force/recon detection). |
| **Permissions** | `FA` | File All | Monitor for "Full Control" changes on sensitive files. |
| **Permissions** | `RY` | Read Property | Monitor for reading sensitive attributes/metadata. |
| **Trustee SID** | `WD` | Everyone | Audits actions from ALL users. |
| **Trustee SID** | `SY` | Local System | Audits actions performed by the system account. |

---

## 4. Adversary TTPs

### **Scenario A: Blind Spot Creation (T1562.002)**
* **Mechanism:** Adversaries use `auditpol.exe`, PowerShell, or direct API calls to remove specific ACEs from an object's SACL.
* **Target:** High-value targets like `C:\Windows\System32\config\SAM` or the `lsass.exe` process.
* **Goal:** To execute Credential Dumping without triggering "Object Access" (Event 4663) alerts.

### **Scenario B: Global Audit Policy Overwrite**
* **Mechanism:** Overwriting system-wide audit policies to disable the "Object Access" category entirely.
* **Detection:** This typically generates **Event ID 4719** (System Audit Policy Changed) rather than 4907.

---

## 5. Detection Engineering (SOC Red Flags)

| Red Flag | Description | Correlation |
| :--- | :--- | :--- |
| **Unauthorized Subject** | Modification of a SACL by a non-admin/non-system user. | Cross-reference with [[1.3_Windows_Event_Core#Event_4907]]. |
| **SACL Stripping** | A new SDDL string that is significantly shorter or missing `SA`/`FA` flags. | Check T1562.002 in [[1.1_Master_Hunting_Matrix]]. |
| **LoLBin Execution** | Execution of `auditpol.exe` or `wevtutil.exe` preceding a 4907 event. | Check [[1.2_Windows_Process_Genealogy]] for parentage. |

---

## Related References
- [1.3_Windows_Event_Core](../../01_Hunting_Cheatsheets/1.3_Windows_Event_Core.md): Log field analysis for Event 4907 and 4663.
- [1.1_Master_Hunting_Matrix](../../01_Hunting_Cheatsheets/1.1_Master_Hunting_Matrix.csv): MITRE TTP mappings for Defense Evasion.
- [[8.1.2_Access_Tokens]]: Understanding the "Subject" side of the security check.
- [8.2.08 GPO Delegation and Abuse Logic](../../08_Underlying_Principles/8.2_Active_Directory/8.2.08_GPO_Delegation_and_Abuse_Logic.md): Practical application of AD-level ACLs and the impact of GPO misconfigurations.