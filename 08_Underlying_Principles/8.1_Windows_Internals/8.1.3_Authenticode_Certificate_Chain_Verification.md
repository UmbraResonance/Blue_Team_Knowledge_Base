# Authenticode & Certificate Chain Verification

> **Core Concept:** Digital signatures provide **Integrity** and **Origin** verification, but they do not guarantee the "Safety" of a file as Windows is context-blind to the signer's identity.
> **Blue Team Impact:** Mastering certificate chain analysis is essential for identifying sophisticated **Defense Evasion (TA0005)** techniques, such as DLL Side-loading and the use of stolen or irrelevant code-signing certificates.

---

## 1. The Three Pillars of Verification
Windows (via `crypt32.dll` and `Wintrust.dll`) validates files based on:
1.  **Integrity**: Does the file hash match the one encrypted in the signature?
2.  **Authenticity**: Is the certificate issued by a trusted Root Certificate Authority (CA)?
3.  **Validity**: Is the certificate within its active date range and not revoked (CRL/OCSP)?

## 2. Trust Anchor Abuse & Context Blindness
* **Trust Anchor Abuse**: Adversaries purchase legitimate certs from cheap CAs or steal private keys from small firms. If the Root CA is in the system's **Trusted Root Store**, Windows marks it as `Valid`.
* **Context Blindness**: Windows validates that a file *is* trusted by someone, not *who* should have signed it. It will not block `svchost.exe` from loading a DLL signed by a "Weather Service App".

## 3. Counter-signatures (Time-stamping)
* **Mechanism**: A trusted third-party (TSA) signs the signature's hash at the time of signing.
* **Adversary TTP**: If a file is time-stamped, Windows considers the signature **Valid even after the certificate expires**, provided it was signed during the certificate's lifetime.
* **Hunter Tip**: In DLL Side-loading analysis, an expired cert with a valid time-stamp often indicates a "Bring Your Own Vulnerable DLL" (BYOVD) attack or the use of legacy, known-vulnerable binaries.

## 4. Verification Workflow (The Chain Walk)
1.  **Leaf Cert**: Check the file's individual certificate.
2.  **Intermediate CA**: Trace back to the signer of that cert.
3.  **Root CA**: Trace back to a built-in trusted root. If the chain is unbroken and not revoked, `Signed` = `true`.

---

## Related References
- [1.3_Windows_Event_Core](../../01_Hunting_Cheatsheets/1.3_Windows_Event_Core.md): Analysis of Sysmon Event 7 fields.
- [1.1_Master_Hunting_Matrix](../../01_Hunting_Cheatsheets/1.1_Master_Hunting_Matrix.csv): Logic for hunting context-mismatched signatures.