# Access Tokens & Privileges

> **Core Concept:** While the SACL is the "Guard" on the object, the Access Token is the "Keycard" held by the Subject.
> **Blue Team Impact:** Identifying Token manipulation is essential for detecting **Privilege Escalation** and **Lateral Movement**.

---

## 1. Technical Architecture: The Access Token
An Access Token is an object that describes the **security context** of a process or thread. It is generated by the **LSA (Local Security Authority)** during the logon process (Event 4624).

### **Token Contents**
* **User SID:** The identity of the account.
* **Group SIDs:** Group memberships (e.g., Domain Admins).
* **Privileges:** Specific "Rights" granted to the account (e.g., `SeDebugPrivilege`).
* **Impersonation Level:** Whether the token can be used to act on behalf of another user.

---

## 2. Privileges vs. Permissions
It is critical to distinguish between these two in your hunting logic:
* **Permissions (DACL/SACL):** Applied to **Objects** (e.g., "Can I read this file?").
* **Privileges:** Applied to **Accounts** (e.g., "Can I shut down the system?").

### **High-Risk Privileges for Blue Teams**
| Privilege | Capability | Adversary Use Case |
| :--- | :--- | :--- |
| **SeSecurityPrivilege** | Manage auditing and view/modify SACLs. | Required to trigger or suppress **Event 4907**. |
| **SeDebugPrivilege** | Attach to and debug any process. | Used to dump memory from `lsass.exe`. |
| **SeBackupPrivilege** | Bypass file permissions to back up files. | Used to steal `NTDS.dit` or `SAM` hives. |
| **SeTakeOwnership** | Take ownership of any object. | Used to bypass DACLs by becoming the owner. |

---

## 3. Adversary TTPs (Token Manipulation)

### **Scenario A: Token Impersonation (T1134)**
* **Mechanism:** An attacker with local admin rights steals a token from a higher-privileged process (e.g., a Domain Admin RDP session) to act as that user.
* **Detection:** Look for **Event 4624 (Logon Type 9)** or mismatched SIDs in process execution.

### **Scenario B: Privilege Escalation via Token Adjustment**
* **Mechanism:** Attackers enable "Disabled" privileges already present in their token (like `SeDebugPrivilege`) to perform sensitive actions.
* **Detection:** Monitor for **Event 4672** (Special privileges assigned to a new logon).

---

## 4. SOC Correlation (The "Subject" Link)

When you see a **4907 (Audit Policy Change)** or a **4688 (Process Start)** in your logs, use the **SubjectLogonId** to pivot:
1.  **Find the Token Origin:** Trace the `SubjectLogonId` back to the original **Event 4624**.
2.  **Verify Privileges:** Check if the account *should* have the `SeSecurityPrivilege` required to modify the SACL.
3.  **Identify Anomalies:** If a standard user account suddenly triggers a 4907, investigate for Token Theft or "Potato" style exploits.

---

## ðŸ”— Related References
- [8.1.1_Object_Security_SACL](./8.1.1_Object_Security_SACL.md): The "Object" side of the access check.
- [1.3_Windows_Event_Core](../../01_Hunting_Cheatsheets/1.3_Windows_Event_Core.md): For analyzing SubjectLogonId in security logs.
- [1.1_Master_Hunting_Matrix](../../01_Hunting_Cheatsheets/1.1_Master_Hunting_Matrix.csv): For TTPs related to Privilege Escalation.