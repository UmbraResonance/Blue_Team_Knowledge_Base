# Manual Mapping & IAT Reconstruction

> **Core Principle**: Standard DLL loading via `LoadLibrary` is highly visible to EDRs. Manual Mapping is a technique where the malware acts as its own Windows Loader to remain "Fileless" in memory.

## 1. The Manual Loading Process
Instead of asking the OS to load a DLL, the malware:
1. **Allocates Memory**: Typically uses `VirtualAlloc` with `RWX` permissions.
2. **Writes Sections**: Copies the DLL's headers and sections into the allocated space.
3. **Relocation**: Manually adjusts the memory addresses within the DLL to match its new base address.
4. **IAT Reconstruction**: Manually resolves the addresses of functions the DLL needs from other libraries (e.g., `ntdll.dll`, `kernel32.dll`).

## 2. Bypassing AMSI (Antimalware Service Interface)
* **The Gap**: AMSI is deeply integrated into the standard Windows Loader and script engines.
* **Native Evasion**: By manually mapping a **Native DLL** (C++/Rust), the malware never triggers the "Image Load" event that AMSI relies on for scanning.

## 3. Detection Heuristics
* **Memory Scanning**: Look for memory pages marked as `RX` or `RWX` that do not have a corresponding file on disk (**Unbacked Memory**).
* **IAT Anomalies**: Check for IAT entries that point to addresses within the process's private memory rather than the export tables of legitimate system DLLs.
* **Sysmon Event 7**: Lack of Sysmon ID 7 (Image Load) for a known malicious capability while the process is clearly exhibiting that behavior.