# Windows Execution Ecosystems & The Call Stack

> **Core Principle**: Windows is a layered system. Regardless of the high-level language used (C#, C++, or JS), every request must eventually converge at the System Call (Syscall) to enter the Kernel.

## 1. User-Mode Ecosystems (The Three Communities)
Windows categorized user-space applications into three primary execution environments, each with distinct auditing characteristics:

| Ecosystem | Technology | Execution Logic | Security & Auditing |
| :--- | :--- | :--- | :--- |
| **Native** | C++, Rust | **Direct Command**. Interacts directly with Win32 APIs and memory pointers. | Opaque, high performance, bypasses AMSI, difficult to reverse-engineer. |
| **Managed** | .NET (C#) | **Supervised**. Runs on the CLR (Common Language Runtime) which manages memory. | Transparent, heavily monitored by AMSI and ETW. |
| **Web-Wrapped**| Electron | **Bridge-based**. Uses a browser engine (Chromium) to call native APIs via a bridge. | Audit focus is on the "Bridge" layer between JS and the OS. |

## 2. The Execution Chain (The Call Stack)
When an application requests an operation (e.g., opening a file), the request follows this lifecycle:

1. **Application Layer**: Initiates the request (e.g., `File.Open` in C# or `CreateFile` in C++).
2. **Runtime Layer (Managed Only)**: `clr.dll` intercepts and translates the request via **P/Invoke**.
3. **Subsystem Layer (Win32 API)**: `kernel32.dll` or `advapi32.dll` performs parameter validation and handle pre-checks.
4. **Native API Layer (ntdll.dll)**: The final stop in User Mode; prepares the **Syscall ID**.
5. **The Border (Syscall)**: Executes the `syscall` assembly instruction, transitioning the CPU to **Ring 0 (Kernel Mode)**.
6. **Kernel Layer (ntoskrnl.exe)**: Performs the final audit and physical hardware operation.

## 3. Detection Strategy: The "Direct Syscall"
* **The Evasion**: Advanced adversaries execute Step 5 directly, skipping `kernel32.dll` and `ntdll.dll` to blind EDR "cameras" (hooks).
* **Hunting Logic**: Analyze the **Thread Call Stack**. If a Syscall is initiated from memory not backed by `ntdll.dll`, it is a high-fidelity indicator of evasion.