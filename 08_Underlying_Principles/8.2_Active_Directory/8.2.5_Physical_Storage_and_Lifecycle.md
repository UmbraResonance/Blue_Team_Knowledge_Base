# Physical Storage and Lifecycle Management

## Overview
Active Directory is physically represented by a database file and a shared folder structure. Understanding how the OS locks these files and manages the lifecycle of deleted objects is critical for forensics.

## Underlying Principles
### Database Integrity and Persistence
The "Heart" of Active Directory is the **NTDS.DIT** file.
- **Windows Internals Bridge:** This file is exclusively locked and managed by the **lsass.exe** process. AD DS runs as a thread within LSASS, handling the I/O for all directory data, including password hashes.

## Key Components
### 1. SYSVOL (The Public Share)
Stores public domain files (GPOs, scripts, policies).
- **Physical Reality:** In hardened environments (e.g., Hydro Tasmania), SYSVOL is often relocated from `C:\Windows` to a dedicated drive for performance and security.
- **DFSR (Distributed File System Replication):** The modern protocol used to synchronize SYSVOL content across all DCs, replacing the legacy FRS.

### 2. Object Lifecycle (Tombstone vs. Recycle Bin)
- **Tombstone:** A deleted object stripped of most attributes, kept for a "Tombstone Lifetime" (default 180 days) for recovery purposes.
- **AD Recycle Bin:** An advanced feature that preserves all attributes of a deleted object, allowing for a "Full Restoration" without needing to restart AD DS or restore from backups.

## Security and Hunting Implications
- **NTDS.DIT Extraction:** Once a DC is compromised, attackers target this file to extract password hashes. Analysts must monitor for VSS (Volume Shadow Copy) service abuse, as it is the standard way to bypass the LSASS file lock.
- **MSBROWSE [01h] (Legacy Archaeology):** A NetBIOS artifact representing the "Master Browser." Its presence indicates the use of SMB v1 and legacy discovery protocols, marking a significant attack surface for NBNS poisoning.
- **Kerberoasting vs. NTDS.dit:** While Kerberoasting is a "live" request for a ticket, its success depends on the service account's password hash stored in **NTDS.dit**. If an attacker has already extracted NTDS.dit (via VSS abuse), they no longer need to perform Kerberoasting. Conversely, Kerberoasting is the "louder" but more accessible method to obtain these hashes without full DC compromise.