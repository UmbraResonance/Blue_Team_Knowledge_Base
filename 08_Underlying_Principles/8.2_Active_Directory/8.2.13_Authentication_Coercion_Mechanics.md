# Authentication Coercion Mechanics

## 1. Description
Authentication Coercion is a technique where an attacker abuses legitimate Windows RPC interfaces to force a remote system—most critically a Domain Controller (DC)—to initiate an outbound authentication request toward an attacker-controlled listener. This "callback" typically uses the system's Machine Account (`Server$`), providing a high-privileged credential for NTLM Relaying or Kerberos Delegation attacks.

## 2. Attack Surface and Vectors
The following protocols provide the primary mechanics for coercion:

| Vector | Protocol | RPC UUID | Primary Function |
| :--- | :--- | :--- | :--- |
| **PrinterBug** | MS-RPRN | `12345678-1234-abcd-ef00-0123456789ab` | `RpcRemoteFindFirstPrinterChangeNotificationEx` |
| **PetitPotam** | MS-EFSR | `c681d588-428e-4515-97a9-24b91903747f` | `EfsRpcOpenFileRaw` |
| **ShadowCoerce**| MS-FSRVP | `a8e0653c-2744-4389-a61d-7373df8b2292` | `IsPathShadowCopied` |

## 3. Underlying Logic
The vulnerability stems from "Insecure by Design" features rather than implementation bugs:
* **Asymmetric Trust**: The target server trusts the RPC request to perform an action (like printer notification or file encryption) and must prove its own identity to the destination specified in the request.
* **Lack of Mutual Authentication**: Legacy RPC calls do not always verify the identity of the requester before initiating the callback.
* **NTLM Fallback**: In cross-segment or unmanaged environments, systems often fallback to NTLM, which is susceptible to relaying.

## 4. Exploitation Path
1. **Coercion**: Use tools like `dementor.py` to trigger the RPC call targeting a DC.
2. **Relay**: Capture the `DC$` NTLMv2 hash via `ntlmrelayx.py`.
3. **Escalation**: Relay the hash to:
    * **DC2 (SMB)**: Perform `DCSync` if SMB Signing is disabled.
    * **AD CS (HTTP)**: Request a certificate for the DC (ESC8).
    * **LDAP**: Configure Resource-Based Constrained Delegation (RBCD).

## 5. References
* [MS-RPRN]: Print System Remote Protocol
* [MS-EFSR]: Encrypting File System Remote (EFSRPC) Protocol