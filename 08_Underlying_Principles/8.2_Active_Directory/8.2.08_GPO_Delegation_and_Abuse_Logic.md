# GPO Delegation and Abuse Logic

## 1. Architectural Overview
Group Policy Objects (GPOs) are not monolithic entities but consist of two distinct components that must remain synchronized. Security weaknesses often arise from misconfigurations in the access control of either component.

### 1.1 The Dual Structure
- **Group Policy Container (GPC)**:
    - **Location**: Stored in Active Directory under `CN=Policies,CN=System,DC=...`.
    - **Role**: Holds metadata, versioning, and the `gPCFileSysPath` attribute, which points to the physical storage in SYSVOL.
- **Group Policy Template (GPT)**:
    - **Location**: Stored in the file system at `\\<Domain>\SYSVOL\<Domain>\Policies\{GUID}`.
    - **Role**: Contains the actual policy settings, including `GptTmpl.inf`, startup/shutdown scripts, and Group Policy Preferences (GPP) XML files.

## 2. Attack Vector: Permissions Abuse (Shadow Admins)
When a non-privileged principal is granted specific Active Directory Rights over a GPO, they become "Shadow Admins" capable of domain-wide impact.

| Right | Exploitation Mechanism |
| :--- | :--- |
| **GenericWrite / GenericAll** | Full control to modify any attribute or the underlying GPT files. |
| **WriteProperty** | Ability to modify `gPCFileSysPath` to point to a malicious GPT location (GPO Hijacking). |
| **WriteDacl** | Ability to modify the object's ACL to grant the attacker `GenericAll` rights. |
| **WriteOwner** | Ability to take ownership and subsequently modify permissions to gain full control. |

## 3. High-Impact Exploitation Scenarios
1. **Local Admin Injection**: Modifying "Restricted Groups" or Group Policy Preferences to force a controlled user into the local `Administrators` group across all targeted endpoints.
2. **Immediate Task Execution**: Deploying an immediate Scheduled Task via `ScheduledTasks.xml` that executes a C2 stager as `NT AUTHORITY\SYSTEM`.
3. **Malicious Startup Scripts**: Placing a persistent `.ps1` or `.bat` script in the GPT `Scripts\Startup` folder to ensure execution during the next boot cycle.

## 4. Technical Security Observations
- **Reconnaissance Accessibility**: By default, the `SYSVOL` share and GPO objects in Active Directory are readable by all `Authenticated Users`. This excessive visibility allows attackers to perform automated ACL audits to identify over-privileged accounts without triggering high-priority alerts.
- **Privilege Escalation via Cross-Boundary Delegation**: Security boundaries are often compromised when administrative accounts from lower-trust zones (e.g., workstation admins) are granted write access to GPOs affecting higher-trust assets (e.g., servers or identity providers). 
- **The "Shadow Admin" Trap**: Many organizations focus on auditing Group Membership while neglecting GPO Delegation. An account with `GenericWrite` on a critical GPO is functionally equivalent to a Domain Admin but often remains hidden during standard identity audits.

---
**References**:
- [8.2.07 GPP cpassword Vulnerability](./8.2.07_GPP_cpassword_Vulnerability.md)