# Identity and Security Principals

## Overview
Active Directory (AD) uses a multi-layered identity system to balance absolute object tracking with flexible, relative permission management. This document outlines the fundamental identifiers used by the operating system to authenticate and authorize Security Principals.

## Underlying Principles
### The Philosophy of Absolute vs. Relative Identity
Microsoft's design distinguishes between an object's "Soul" (GUID) and its "Citizen ID" (SID). 
- **The GUID (Global Unique Identifier):** A 128-bit value (stored in `objectGUID`) assigned at creation. It is the "True Name" of an objectâ€”absolutely unique and immutable across the entire forest.
- **The SID (Security Identifier):** A variable-length string representing the "Current Identity." It is tied to the domain and can change if an object is moved or re-created.

## Internal Mechanisms
### 1. Security Principals
Security Principals are any entities authenticated by the OS, including:
- **Users and Computers:** Individual accounts.
- **Service Accounts:** Processes running in a specific security context (e.g., an application running under a Managed Service Account).
- **Groups:** Collections of principals used for access control.

### 2. Access Token Orchestration (Internals Bridge)
When a principal authenticates, the **Local Security Authority Subsystem Service (lsass.exe)** generates an **Access Token**. 
- The token contains the Primary SID, group SIDs, and crucially, the **sIDHistory**.
- **sIDHistory:** A multi-valued attribute that retains SIDs from "former lives" (previous domains). This ensures seamless access to legacy resources during migrations, reflecting Microsoft's commitment to backward compatibility.

## Security and Hunting Implications
- **SID History Injection:** Attackers with sufficient privileges can inject high-privileged RIDs (like 500 or 512) into a standard user's `sIDHistory` to achieve stealthy persistence.
- **GUID Tracking:** Since GUIDs never change, they are the most reliable way to track malicious objects across environment changes, even if the `sAMAccountName` or `displayName` is altered.

## 3. Object Classification: Securable vs. Informational
To prioritize hunting efforts, objects must be categorized by their ability to hold permissions.

| Category | Object Types | Identity Marker | Hunting Significance |
| :--- | :--- | :--- | :--- |
| **Securable (Principals)** | Users, Computers, Groups | **SID + GUID** | Can be granted rights in a DACL; acts as a source of activity. |
| **Informational** | Contacts, Shared Folders, Printers | **GUID Only** | Cannot initiate actions; exists only for discovery or metadata. |

## 4. Foreign Security Principals (FSP): The Trust Anchor
FSPs are "placeholder" objects used to represent security principals from a trusted external forest.
- **Internal Logic:** Located in `CN=ForeignSecurityPrincipals`. They hold the SID of the foreign object to allow name resolution across trusts.
- **Hunting Tip:** If an unknown SID (FSP) appears in a local high-privileged group, it indicates an external forest user has been granted lateral access to your domain.