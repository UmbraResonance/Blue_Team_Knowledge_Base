# DCSync Attack and Directory Replication Logic

## Overview
DCSync is a credential theft technique that leverages the Microsoft Directory Replication Service Remote Protocol (MS-DRSR). Instead of compromising a Domain Controller (DC) to steal the `ntds.dit` database, an attacker simulates the behavior of a DC to request password data from a targeted domain controller.

## Technical Prerequisites
To perform a DCSync attack, a security principal must have specific **Extended Rights** on the domain root object. These are not administrative permissions but functional replication rights:

1. **Replicating Directory Changes**
   - GUID: `{1131f6aa-9c07-11d1-f79f-00c04fc2dcd2}`
   - Purpose: Allows the principal to synchronize non-secret domain data.
2. **Replicating Directory Changes All**
   - GUID: `{1131f6ad-9c07-11d1-f79f-00c04fc2dcd2}`
   - Purpose: Allows the principal to synchronize all data, including sensitive "Secret" attributes (NTLM hashes, Kerberos keys).

## Attack Execution
Attackers typically use tools like Mimikatz or Impacket:
- **Mimikatz**: `lsadump::dcsync /domain:example.local /user:administrator`
- **Secretsdump**: `python3 secretsdump.py example.local/user@10.10.10.10`

## Detection Strategy
The primary detection artifact is **Windows Event ID 4662** on Domain Controllers.
- **Object Type**: `domainDNS`
- **Access Mask**: `0x100` (Control Access)
- **Properties**: Look for the specific GUIDs mentioned above.
- **Anomaly Logic**: Monitor for 4662 events where the `SubjectUserName` is NOT a computer account (ending in `$`) or an authorized replication service account.