# Kerberos Golden Ticket Mechanics

## 1. Architectural Overview
The Golden Ticket attack exploits the fundamental trust model of the Kerberos KDC. By compromising the `krbtgt` account, an adversary can bypass the entire authentication (AS) phase.

### 1.1 The Role of krbtgt
- **The Domain "Master Key"**: The KDC service on a Domain Controller uses the `krbtgt` NTLM hash or AES key to sign and encrypt all TGTs issued within the domain.
- **Verification Logic**: When a user presents a TGT to request a service ticket (TGS), the KDC decrypts the TGT using its `krbtgt` key. If the decryption succeeds and the signature is valid, the KDC assumes the TGT is legitimate, regardless of whether the user actually exists in Active Directory.

## 2. Attack Vector: Forgery Chain
To forge a Golden Ticket, an attacker requires four specific pieces of information:
1. **FQDN**: The fully qualified domain name.
2. **Domain SID**: The Security Identifier of the domain (obtainable via `Get-DomainSID`).
3. **krbtgt Hash**: Typically an NTLM hash (RC4) or AES-256 key stolen via DCSync.
4. **Target User RID**: Usually set to `500` (Built-in Administrator) to ensure maximum privilege regardless of account renaming.

## 3. Critical Mitigation: The Double Reset Rule
Preventing forged tickets is difficult because they are cryptographically "correct." The primary recovery mechanism is the rotation of the `krbtgt` key.
- **The Two-Password Buffer**: AD maintains the current and previous `krbtgt` passwords to prevent immediate authentication failures during replication. 
- **The Procedure**: The `krbtgt` password must be reset **twice**. A 10-hour (minimum) interval is recommended between resets to allow existing legitimate tickets to expire naturally and to ensure full DC replication.
- **Automation**: Using Microsoft's `KrbtgtKeys.ps1` script is highly recommended to manage replication and audit impact.

## 4. Technical Security Observations
- **Encryption Downgrade**: While attackers can use AES keys, many scripts default to RC4 (`0x17`). Monitoring for RC4 TGS requests in an AES-enforced domain is a high-fidelity indicator.
- **Persistence Boundary**: A Golden Ticket is a persistence mechanism, not just a privilege escalation tool. By default, forged tickets have a **10-year lifetime**, allowing long-term, silent access even if the original user's password is changed.

---
**References**:
- [1.1_Master_Hunting_Matrix.csv](../../01_Hunting_Cheatsheets/1.1_Master_Hunting_Matrix.csv)
- [8.2.06_Kerberos_Protocol_and_Encryption.md](./8.2.06_Kerberos_Protocol_and_Encryption.md)
- [8.2.10_DCSync_Attack_Logic.md](./8.2.10_DCSync_Attack_Logic.md)