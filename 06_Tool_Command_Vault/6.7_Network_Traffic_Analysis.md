# Network Analysis Workflows (CLI & Extraction)

> **Focus:** Handling large PCAPs, automating extraction, and CLI analysis.
> **Tools:** Tshark (CLI), NetworkMiner (Artifacts), Wireshark (GUI Setup).
> **Reference:** For specific filter syntax (e.g., HTTP/SMB/Kerberos), see `01_Hunting_Cheatsheets/1.4_Network_Protocol_Filters.csv`.

---

## Tshark (Command Line Wireshark)
*Use Case: PCAP is too large (>500MB) for Wireshark, or you need to grep specific fields.*

### Triage & Statistics

**Protocol Hierarchy (What's in this PCAP?):**
```bash
tshark -r <PCAP_FILE> -q -z io,phs
```
**Top Talkers (Who is connecting?):**
```bash
tshark -r <PCAP_FILE> -q -z conv,ip
```

**Conversation List (Detailed Flows):**
```bash
tshark -r <PCAP_FILE> -n -z conv,tcp
```

### Hunting & Filtering

**Extract HTTP Host Headers (Which sites were visited?):**
```bash
tshark -r <PCAP_FILE> -Y "http.request" -T fields -e http.host | sort | uniq -c | sort -nr
```

**Extract DNS Queries (C2 Domains?):**
```bash
tshark -r <PCAP_FILE> -Y "dns.flags.response == 0" -T fields -e dns.qry.name | sort | uniq -c | sort -nr
```

**Extract User Agents (Spot tools like Nmap/Sqlmap):**
```bash
tshark -r <PCAP_FILE> -Y "http.user_agent" -T fields -e http.user_agent | sort | uniq -c
```

### Traffic Slicing (Carving)

*Action: Extract attacker's traffic to a new, smaller PCAP for Wireshark analysis.*

```bash
tshark -r <FULL_PCAP> -Y "ip.addr == <ATTACKER_IP>" -w attacker_traffic.pcap
```

## NetworkMiner (Automated Extraction)

*Use Case: "Lazy" extraction of files, images, and credentials without crafting filters. Note: NetworkMiner runs on Windows (or via Mono on Linux).*

**Key Tabs to Check (BTL1 Priority):**
- **Files:** Automatically reassembles .exe, .pdf, .docx from the stream.
    - Action: Right-click file -> "Open Folder" -> Calculate Hash immediately.
- **Credentials:** Auto-extracts cleartext (FTP, HTTP Basic, POP3, IMAP).
- **Images:** Reconstructs images (useful for finding "confidential" screenshots exfiltrated).
- **Parameters:** Shows extracted HTTP GET/POST parameters (great for spotting SQLi/XSS payloads).

## Wireshark GUI Workflows (Setup & Config)

*Configuration steps that aren't "filters" but are critical for analysis.*

### C2 Jitter Analysis (Time Delta)

*Goal: Detect automated beaconing (e.g., malware phoning home exactly every 5.0 seconds).*

- Menu: View -> Time Display Format -> Seconds Since Previous Displayed Packet.
- Filter: Apply ip.addr == <C2_IP>.
- Sort: Click the "Time" column header.
- Analyze: Look for consistent patterns (e.g., 5.002, 5.010, 4.998).

### Column Customization (Data Exfiltration)

*Goal: See data size directly in the packet list.*

- Right-click Column Header -> Column Preferences.
- Add Column:
    - Title: Packet Length
    - Type: Packet length (bytes)
- Use Case: Sort by Length to find the largest packets (potential file uploads).

### Export Objects (File Recovery)

*Goal: Save a file from HTTP/SMB streams.*

- HTTP: File -> Export Objects -> HTTP -> Save specific file.
- SMB: File -> Export Objects -> SMB/SMB2 -> Save file.