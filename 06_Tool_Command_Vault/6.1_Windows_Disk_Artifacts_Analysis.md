# 6.1 Windows Disk Artifact Analysis

> **Focus:** Parsing disk artifacts (Prefetch, MFT, Registry, Browsers) for evidence.
> **Tools:** EZ Tools (Zimmerman), CAPE, Hindsight, bstrings.
> **Note:** Run PowerShell/CMD as **Administrator**.
> **Legend:** Replace values inside `<...>` with your actual paths.

---

## Eric Zimmerman Tools (EZ Tools)

### Prefetch (PECmd)

*Evidence: Prove execution & verify execution time.*

**Parse a single file (Target specific malware):**
```powershell
PECmd.exe -f "PATH_TO_MALICIOUS_FILE.pf>â€œ
# Default Prefetch files are under C:\Windows\Prefetch in living system.
```

**Parse WHOLE directory to CSV (The Standard Move):**
```powershell
# Parse WHOLE directory to CSV (The BTL1 Standard Move)
PECmd.exe -d "<DIRECTORY_WITH_PREFETCH_FILES>" -csv "C:\Temp\Output" -q
# Default Prefetch files are under C:\Windows\Prefetch in living system.
```

- Key Output: RunCount, LastRun (UTC), ExecutablePath.

### MFT (MFTECmd)

*Evidence: File creation, deletion, and timestomping checks.*

**Parse $MFT to CSV:**
```powershell
MFTECmd.exe -f "<PATH_TO_$MFT_FILE>" -csv "<OUTPUT_DIRECTORY>" --csvf <OUTPUT_FILENAME.csv>

# Default MFT file path is C:\$MFT
```

- Tip: Filter output CSV for .exe, .ps1, or Zone.Identifier (ADS).

### JumpLists (JLECmd)

*Evidence: Application-specific recent file access history. (e.g., Which Word docs were opened?)*

**Parse AutomaticDestinations/CustomDestinations to CSV:**
```powershell
JLECmd.exe -d "<PATH_TO_USER_AUTOMATICDESTINATIONS>" --csv "<OUTPUT_DIRECTORY>" -q
# Path: 
# 1. C:\Users\<USERNAME>\AppData\Roaming\Microsoft\Windows\Recent\AutomaticDestinations
# 2. C:\Users\<User>\AppData\Roaming\Microsoft\Windows\Recent\CustomDestinations
```

### LNK Files (LECmd)

*Evidence: File execution, original path, and MAC times. (Use this to prove a file existed on a specific drive/path)*

**Parse LNK Files in Recent Folder to CSV:**
```powershell
LECmd.exe -d "<PATH_TO_USER_RECENT>" --csv "<OUTPUT_DIRECTORY>" -q
# Path: C:\Users\<USERNAME>\AppData\Roaming\Microsoft\Windows\Recent
```

### ShellBags (SBECmd)

*Evidence: Folder Browsing history. (Proof that the user navigated into specific folders, e.g., C:\Confidential)*

**Parse UsrClass.dat (Standard User) to CSV:**
```powershell
SBECmd.exe -d "<DIRECTORY_WITH_USRCLASS.DAT>" --csv "<OUTPUT_DIRECTORY>" -q
# Path: C:\Users\<USERNAME>\AppData\Local\Microsoft\Windows\UsrClass.dat
```

### ShimCache (AppCompatCacheParser)

*Evidence: Execution history, even if file is deleted.*

**Parse SYSTEM hive to CSV:**
```powershell
AppCompatCacheParser.exe --csv "<OUTPUT_DIRECTORY>" -f "<PATH_TO_SYSTEM_HIVE>"
# Example: AppCompatCacheParser.exe --csv "C:\Temp" -f "C:\Windows\System32\config\SYSTEM"
```

### Amcache (AmcacheParser)

*Evidence: SHA1 hashes of executed binaries.*

**Parse Amcache.hve: to CSV**
```powershell
AmcacheParser.exe --csv "<OUTPUT_DIRECTORY>" -f "<PATH_TO_AMCACHE_HIVE>" -i on
# Example: AmcacheParser.exe --csv "C:\Temp" -f "C:\Windows\appcompat\Programs\Amcache.hve" -i on
```

- Flag Note: `-i on` includes unassociated file entries (Important for loose binaries).

### Recycle Bin (RBCmd)

*Evidence: Deleted files recovery, original path, and deletion timestamp.*
*(Parses $I files which contain the metadata of deleted files)*

**Parse Recycle Bin:**
```powershell
RBCmd.exe -d "<PATH_TO_RECYCLE_BIN>" --csv "<OUTPUT_DIRECTORY>" -q
# Path: C:\$Recycle.Bin
# Note: You might need to parse specific SID folders inside $Recycle.Bin if permission denied.
```

### Pagefile & Memory Strings (bstrings)

*Evidence: Finding IOCs (IPs, Domains, Passwords) in raw memory dumps or Pagefile.sys.*
*(Use this when you don't have a structured RAM dump but have the disk image)*

*Evidence: Finding IOCs (IPs, Domains, Passwords) in system memory files.*
*(Pagefile.sys = Swapped out memory; hiberfil.sys = Compressed RAM snapshot from hibernation)*

**Search in Pagefile or Hiberfil:**
```powershell
# Search Pagefile
bstrings.exe -f "<PATH_TO_PAGEFILE.SYS>" --qs "<MALICIOUS_DOMAIN>"
# Path: C:\pagefile.sys (Hidden system file at C: root)

# Search Hiberfil (Hibernation File)
bstrings.exe -f "<PATH_TO_HIBERFIL.SYS>" --qs "<MALICIOUS_DOMAIN>"
# Path: C:\hiberfil.sys (Hidden system file at C: root)
```

## KAPE (Kroll Artifact Parser and Extractor)

*Use for rapid triage collection or batch processing.*

**Collect Evidence**
```powershell
.\kape.exe --tsource <SOURCE_DRIVE_LETTER> --tdest "<DESTINATION_FOLDER>" --tflush --target KapeTriage --volshadows
# Example: .\kape.exe --tsource C: --tdest "Z:\Case_101\Triage" ...
```

**Process/Parse Collected Evidence**
```powershell
.\kape.exe --msource "<PATH_TO_COLLECTED_EVIDENCE>" --mdest "<PATH_TO_PROCESSED_OUTPUT>" --module EZParser --trace --debug
# Example: .\kape.exe --msource "Z:\Case_101\Triage" --mdest "Z:\Case_101\Timeline" ...
```

## Other Essential Forensics Tools

### Browser Forensics (Hindsight)

*Evidence: Web history, Downloads, Cache, and Cookies. (Developed by Ryan Benson. Best tool for Chrome/Edge analysis)*

**Parse Chrome/Edge History:**
```powershell
hindsight.exe -i "<PATH_TO_BROWSER_PROFILE>" -o "<OUTPUT_DIRECTORY>"
# Chrome Path: C:\Users\<USERNAME>\AppData\Local\Google\Chrome\User Data\Default
# Edge Path:   C:\Users\<USERNAME>\AppData\Local\Microsoft\Edge\User Data\Default
```