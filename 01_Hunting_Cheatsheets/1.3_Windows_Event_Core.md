# Windows Event Core Deep-Dive

> [!TIP]
> **Priority Strategy:** Focus on P0 (Execution/Auth) for daily hunting. Use Category 0 (Integrity) to verify your visibility.

## Category 0: Defense Integrity

*Purpose: Ensuring the "Security Cameras" are not tampered with.*

### Event 4907: Object Audit Policy Changed
* **Priority:** High Impact / Low Frequency (Defense Evasion)
* **Adversary Intent:** Defense Evasion (TA0005). Specifically targeting Impair Defenses: Disable Windows Event Logging (T1562.002). Advanced actors modify SACLs to "silence" audit logs before accessing sensitive objects (e.g., lsass.exe, NTDS.dit, or Registry Keys).
* **Key Fields to Analyze:**
    - SubjectUserName: Who performed the change? (Suspicious if not a known Admin/System account).
    - Object Name: Which sensitive path was silenced?
    - Security Descriptor (SDDL): The core string describing the audit change.
* **SDDL Analysis Tip (SACL Focus):**
    - Specifically monitor for the removal of SA (Success) or FA (Failure) flags in the S:(AU;...) string.
    - Example: If (AU;SAFA;...;WD) is changed, the attacker has disabled auditing for "Everyone" (WD).
* **Reference:** [8.1.1_Object_Security_SACL](../08_Underlying_Principles/8.1_WIndows_Internals/8.1.1_Object_Security_SACL.md) (Mechanism of SACL modification)

### Event 1102: The Audit Log Was Cleared

* **Priority:** Critical Impact / Low Frequency
* **Adversary Intent:** Defense Evasion (TA0005). Attackers wiping tracks after compromise.
* **Logic:** This event should NEVER happen in a healthy environment.
* **Key Fields to Analyze:** 
    - SubjectUserSid (Who wiped it?).

### Event 5136: A directory service object was modified
* **Priority:** P1: Warning (Defense Evasion / Integrity)
* **Adversary Intent:** Defense Evasion (TA0005) or Privilege Escalation (TA0004). Specifically targeting Domain Policy Modification (T1484.001) by modifying GPO attributes such as `gPCFileSysPath` to hijack policy execution.
* **Key Fields to Analyze:**
    - **Object Class**: Specifically monitor for `groupPolicyContainer`.
    - **Attribute Name**: `gPCFileSysPath` (points to the GPT in SYSVOL) or `nTSecurityDescriptor` (ACL changes).
    - **SubjectUserName**: The account that performed the modification.
* **Technical Observation:** his event provides granular visibility into "what" was changed (Value), which is superior to Event 4662 for integrity auditing. Any unauthorized modification to core infrastructure objects should be treated as a potential indicator of a compromised administrative principal.
* **Reference:** [8.2.08 GPO Delegation and Abuse Logic](../08_Underlying_Principles/8.2_Active_Directory/8.2.08_GPO_Delegation_and_Abuse_Logic.md)

### Event 4670: Permissions on an object were changed
* **Priority:** P1: Warning (Defense Evasion / Integrity)
* **Adversary Intent:** Defense Evasion (TA0005) or Privilege Escalation (TA0004). Attackers modify the Discretionary Access Control List (DACL) of high-value objects—such as system files, registry keys, or GPO templates—to grant themselves persistent access or to silence security auditing by tampering with System Access Control Lists (SACLs).
* **Detection Logic:** Monitor for permission changes where the **Object Type** is `File` (specifically targeting sensitive paths like `SYSVOL`, `System32`, or `drivers`) or `SAM` (Security Accounts Manager). Focus on events where the **SubjectUserName** is not part of an authorized administrative group, and analyze the **New Security Descriptor** for the addition of Full Control or Write access (e.g., `(A;;FA;;...)` or `(A;;FW;;...)`) to non-privileged SIDs.
* **Key Fields to Analyze:**
    - **Object Type**: The category of the object (e.g., File, Key, SAM).
    - **Object Name**: The full path to the resource being modified.
    - **SubjectUserName**: The identity responsible for the permission change.
    - **Original / New Security Descriptor**: The SDDL strings used to identify the specific Access Control Entry (ACE) modifications.
* **Technical Observation:** While Event 5136 tracks changes to Active Directory objects, Event 4670 provides visibility into the underlying file system or registry layer. For GPO security, this event is critical for detecting "backdoor" permissions added directly to Group Policy Template (GPT) files in `SYSVOL`, which might bypass directory-level auditing.
* **Reference:** [8.2.08 GPO Delegation and Abuse Logic](../08_Underlying_Principles/8.2_Active_Directory/8.2.08_GPO_Delegation_and_Abuse_Logic.md)

### Event 4742: A computer object was changed

* **Priority:** P1: Warning (Privilege Escalation / Integrity)
* **Adversary Intent:** Privilege Escalation (TA0004). Specifically targeting **Resource-Based Constrained Delegation (RBCD)** (T1558). Attackers with `GenericWrite` permissions over a computer object modify the `msDS-AllowedToDelegateToAccount` attribute to grant themselves administrative access.
* **Key Fields to Analyze:**
    - **AttributeName:** Specifically monitor for `msDS-AllowedToDelegateToAccount`.
    - **SubjectUserName:** The account performing the modification. High risk if it is a non-admin user or a newly created machine account (see Event 4741).
    - **TargetUserName:** The computer being "backdoored" with new delegation rights.
* **Detection Logic:**
    - **RBCD Property Modification:** Alert on any modification to the `msDS-AllowedToDelegateToAccount` attribute where the `SubjectUserName` does not belong to an authorized administrative group.
    - **Account Correlation:** Correlate this event with Event 4741 (Machine Account Created) within a short time window. This identifies the "Create Account -> Assign RBCD" attack pattern.
* **Technical Observation:** RBCD allows lateral movement without requiring Domain Admin privileges if an attacker can compromise a principal with write access to the target computer's AD object. Unlike classic KCD, the trust is configured on the resource side.
* **Reference:** - [8.2.12_Kerberos_Delegation_Mechanics](../08_Underlying_Principles/8.2_Active_Directory/8.2.12_Kerberos_Delegation_Mechanics.md)

---

## Category 1: Execution & Lineage (P0)

*Purpose: Catching the act of execution.*

### Event 4688: New Process Created

* **Priority:** Critical Impact / High Frequency
* **Adversary Intent:** Cross-Tactic Execution Carrier. Primarily associated with Execution (TA0002), but serves as the visibility engine for Persistence, Privilege Escalation, and Credential Access.
* **Key Fields to Analyze:**
    - NewProcessName: Full path of the executable. Check for random strings or non-standard directories.
    - ParentProcessName: Critical for lineage. Verify against [1.2_Windows_Process_Genealogy](./1.2_Windows_Process_Genealogy.csv).
    - CommandLine: The primary source for identifying download cradles and obfuscation (e.g., Base64).
    - SubjectLogonId: Useful for correlating the process back to a specific login session (Event 4624).
* **Detection Logic (General Principles):**
    * **Lineage Check:** Flag illegal parents.
    * **Command Line Audit:** Analyze the `CommandLine` field for obfuscation (Base64), download cradles, or LoLBin abuse.
    * **Path Anomaly:** Monitor executions from writable directories (`\Temp`, `\Public`, `\PerfLogs`).
* **Reference:** For specific threat mappings (e.g., Mimikatz, Certutil), see [1.1_Master_Hunting_Matrix](./1.2_Windows_Process_Genealogy.csv).

## Event 4648: A Logon Was Attempted Using Explicit Credentials

* **Priority: High Impact / Medium Frequency**
* **Adversary Intent:** Lateral Movement (TA0008) / Defense Evasion (TA0005).
* **Mechanism:** This is triggered by runas.exe or C2 frameworks (Cobalt Strike make_token, spawnas) creating a process with different credentials than the current user.
* **Key Fields to Analyze:**
    - SubjectUserName (The Attacker): The account currently running the malicious process.
    - TargetUserName (The Victim/Target): The account they are trying to become (e.g., Administrator).
    - ProcessName (The Weapon): The process requesting the new credential.
        - Suspicious: cmd.exe, powershell.exe, rundll32.exe.
        - Benign: mstsc.exe (RDP), explorer.exe (Mapping drives).
    - TargetServerName: If this is not localhost, they are moving laterally to another machine.
* **Detection Logic (General Principles):**
    - Process Lineage is King: This event is the "smoke"; the "fire" is the parent process. Do not just alert on the event; investigate the ProcessName field.
    - The "Unexpected Parent" pattern: Normal 4648s come from explorer.exe (user mapping a drive). Malicious 4648s typically originate from cmd.exe, powershell.exe, or rundll32.exe. Focus your triage on these high-risk parents. 
* **Reference:** [1.2_Windows_Process_Genealogy](./1.2_Windows_Process_Genealogy.csv) (Trace the Parent Process of this event to find the patient zero).

## Sysmon Event 7: Image Loaded

* **Priority:** Medium Impact/ High Frequency (Contextual P1 for critical processes)
* **Adversary Intent:** **Defense Evasion (TA0005).** Primarily used for DLL Side-Loading, DLL Search Order Hijacking, and Code Signing subversion.
* **Key Fields to Analyze:**
    - Image: The process performing the load.
    - ImageLoaded: Full path of the DLL. Focus on writable paths (`\Temp`, `\AppData`).
    - Signed: Boolean status of the digital signature.
    - Signature: The name of the signer. Critical for spotting "irrelevant" or mismatched certs.
    - SignatureStatus: Status (Valid, Invalid, Expired).
* **Detection Logic (General Principles):**
    - Context Mismatch: Identify DLLs where `Signed=true` but the vendor is unrelated to the process (e.g., `explorer.exe` loading a DLL signed by a random trading company).
    - Unsigned in System Process: Alert on any unsigned DLL loaded by critical processes like `lsass.exe` or `csrss.exe`.
    - Path Anomaly: Monitor processes loading DLLs from user-writable directories (\AppData, \Temp, \Public).
    - Specific Red Flag: .NET Injection Indicator
        - Trigger: Loading of clr.dll and clrjit.dll in native (non-managed) processes.
        - Significance: High-confidence indicator of Execute-Assembly or Reflective .NET Loading.
        - Focus Processes: svchost.exe, werfault.exe, spoolsv.exe, notepad.exe.
* **Reference:** [8.1.3_Authenticode_Verification](../08_Underlying_Principles/8.1_WIndows_Internals/8.1.3_Authenticode_Certificate_Chain_Verification.md) (Underlying chain of trust logic).

### Sysmon Event 10: Process Access

* **Priority:** Critical Impact / High Frequency
* **Adversary Intent:** Credential Access (TA0006) / Injection (TA0004). Often used for LSASS memory dumping.
* **Key Fields to Analyze:**
    - SourceImage: The actor process.
    - TargetImage: The victim process (e.g., lsass.exe).
* **Detection Logic**
    - CallTrace: **The "UNKNOWN" Pattern.** Flag entries pointing to memory regions not backed by disk files (indicates shellcode/reflective loading).

---

## Category 2: Authentication

*Purpose: Identifying Lateral Movement.*

### Event 4624: Success Logon

* **Priority:** Critical Impact / High Frequency
* **Adversary Intent:** Lateral Movement (TA0008) / Persistence (TA0003). Identifying how a user logged in (Logon Type) is the primary method for distinguishing legitimate admin activity from an attacker moving through the network.
* **Key Fields to Analyze:**
    - Logon Type:
        - Type 2 (Interactive): Local keyboard/screen access.
        - Type 3 (Network): Accessing shared folders, printers, or PsExec/WMI. (High volume, high value).
        - Type 10 (RemoteInteractive): RDP access.
    - WorkstationName / SourceNetworkAddress: Where did they come from? (Look for non-standard admin workstations).
    - ProcessName: What process initiated the logon? (e.g., advapi is normal, but strange binaries here are suspicious).
    - TargetUserName: Who is being impersonated?
* **Detection Logic (General Principles):**
    - RDP Anomalies: LogonType=10 AND SourceNetworkAddress != Internal Admin Subnets.
    - Lateral Movement: LogonType=3 AND TargetUserName == "Admin" AND SourceNetworkAddress != Domain Controller.
    - Pass-the-Hash: Monitoring for LogonType=3 combined with specific NTLM authentication packages (Event 4624 + Event 4776 anomalies).

### Event 4625: An Account Failed to Log On

* **Priority:** High Impact / High Frequency
* **Adversary Intent:** Credential Access (TA0006). High volumes indicate Brute Force, while low-and-slow patterns across multiple users indicate Password Spraying.
* **Key Fields to Analyze:**
    - Failure Reason (SubStatus): The "Why".
        - 0xC0000064: User Name does not exist (Enumeration).
        - 0xC000006A: Correct User, Wrong Password (Brute Force target).
        - 0xC0000234: Account Locked Out.
    - LogonType: The "Vector".
        - Type 3: SMB/Kerberos (Network Spraying).
        - Type 10: RDP (External Brute Force).
    - WorkstationName / SourceNetworkAddress: The "Source".
* **Detection Logic (Pattern Analysis):**
    - Brute Force: Same TargetUserName + High Count of 4625 + Same SourceNetworkAddress.
    - Password Spraying: Many distinct TargetUserName + Low Count per User + Single SourceNetworkAddress.
    - RDP Attack: LogonType=10 + SubStatus=0xC0000064 (Attacker guessing usernames).

### Event 4776: The Computer Attempted to Validate the Credentials for an Account

* **Priority:** High Impact / High Frequency
* **Adversary Intent:** Credential Access (TA0006) / Lateral Movement (TA0008). This is the definitive log for **NTLM authentication** attempts on Domain Controllers or for local accounts.
* **Key Fields to Analyze:**
    - **Package Name**: Always `MICROSOFT_AUTHENTICATION_PACKAGE_V1_0` (NTLM).
    - **Logon Account**: The target username (e.g., `svc-iis`).
    - **Source Workstation**: The machine name that initiated the request. Note: This can be spoofed by adversaries.
    - **Error Code**:
        - `0x0`: Success.
        - `0xC000006A`: Correct username, wrong password.
        - `0xC0000064`: User does not exist (Enumeration indicator).
        - `0xC0000072`: Account is currently disabled.
* **Detection Logic:**
    - **Credential Spraying**: Monitor for a single source workstation generating 4776 failures across multiple unique `Logon Account` values within a short time window.
    - **Protocol Downgrade**: Monitor for successful 4776 logs for high-privileged accounts in environments where Kerberos is enforced.
* **Reference:** 
    - [8.2.09_NTLM_Authentication_Mechanism](../08_Underlying_Principles/8.2_Active_Directory/8.2.09_NTLM_Authentication_Mechanism.md)
    - [1.4_Network_Protocol_Filters](./1.4_Network_Protocol_Filters.csv) (Compare with Kerberos 4768/4771).

### Event 4771: Kerberos Pre-Authentication Failed

* **Priority:** High Impact / High Frequency (Noise reduction required)
* **Adversary Intent:** Credential Access (TA0006).
    - Brute Force: Trying to guess passwords for a valid user.
    - Kerberoasting (CRITICAL): Requesting tickets with weak encryption (RC4) to crack offline.
* **Key Fields to Analyze:**
    - Failure Code (Status): The specific reason for failure.
        - 0x18 (Pre-auth failed): Wrong password. (Most common for Brute Force).
        - 0x6 (Client not found): User doesn't exist. (Username Enumeration).
        - 0x12 (Account disabled/expired): Attacker targeting old accounts.
    - TicketEncryptionType: The encryption algorithm used.
        - 0x17 (RC4-HMAC): RED FLAG. Modern Windows uses AES (0x11/0x12). If you see 0x17, it’s often an attacker forcing a downgrade or performing Kerberoasting.
    - TargetUserName: The account being attacked.
    - IpAddress: The source of the attack.
* **Detection Logic:**
    - Encryption Mismatch: Focus on finding tickets requested with RC4 (0x17) encryption. In a modern domain (AES default), this specific pattern strongly implies a Kerberoasting attempt or a legacy misconfiguration, rather than a simple wrong password.
    - Volume Analysis: A single 4771 is noise; a burst of 4771s from one IP against many users is a spray.
* **Reference:** 
    - [1.4_Network_Protocol_Filters](./1.4_Network_Protocol_Filters.csv) (Compare with NTLM 4625).
    - [8.2.6_Kerberos_Protocol_and_Encryption](../08_Underlying_Principles/8.2_Active_Directory/8.2.6_Kerberos_Protocol_and_Encryption.md)

### Event 4768: Kerberos Authentication Ticket (TGT) Requested

* **Priority:** High Impact / Medium Frequency
* **Adversary Intent:** Credential Access (TA0006) - AS-REP Roasting. Attackers target accounts where Kerberos pre-authentication is disabled to obtain an encrypted TGT that can be cracked offline.
* **Key Fields to Analyze:**
    * **Pre-Authentication Type:** `0` (Logon without pre-authentication). This is the primary indicator of a vulnerable account configuration.
    * **Ticket Encryption Type:** `0x17` (RC4-HMAC). Adversaries force a downgrade to RC4 because its hashes are significantly faster to crack than modern AES.
    * **IpAddress:** The source of the request.
* **Detection Logic (The "Roast" Signal):**
    * **High Fidelity:** Monitor for `EventID=4768` AND `PreAuthType=0` AND `TicketEncryptionType=0x17`.
    * **Baseline Anomaly:** Investigate if an IP address is requesting TGTs for multiple unique accounts within a short window, especially if those accounts are set to not require pre-auth.
* **Reference:** [8.2.6_Kerberos_Protocol_and_Encryption](../08_Underlying_Principles/8.2_Active_Directory/8.2.6_Kerberos_Protocol_and_Encryption.md) (Understanding Pre-auth bypass).

### Event 4769: A Kerberos Service Ticket was Requested

* **Priority:** High Impact / High Frequency (Requires Noise Filtering)
* **Adversary Intent:** Credential Access (TA0006) / Privilege Escalation (TA0004).
    - **Kerberoasting (T1558.003):** Requesting service tickets for accounts with SPNs to crack hashes offline.
    - **Golden Ticket (T1558.001):** Utilizing a forged TGT (signed by stolen `krbtgt` hash) to request service tickets without prior KDC authentication.
    - **Kerberos Delegation Abuse (T1558):** Specifically targeting **S4U2self** and **S4U2proxy** to impersonate high-privileged users via compromised service accounts.
* **Key Fields to Analyze:**
    - **Service Name:** The SPN being targeted. In delegation attacks, focus on the service account performing the impersonation or service names starting with `S4U`.
    - **Ticket Encryption Type:** - `0x17` (RC4-HMAC): **CRITICAL RED FLAG.** Indicates a Kerberoasting attempt, a forged Golden Ticket, or a forced downgrade for easier cracking.
        - `0x11`/`0x12` (AES): Modern standard; harder to crack but can still be used in advanced attacks if keys were stolen.
    - **Ticket Options:** Look for `0x40810000`. This is the default flag for tickets generated by Mimikatz/Rubeus.
    - **TargetUserName:** The account the ticket is issued for. In Golden Ticket or S4U attacks, this is the victim being impersonated.
    - **IpAddress:** The source of the request.
* **Detection Logic (Integrated Kerberos Abuse Strategy):**
    - **Strategy A: The Honey SPN Trap (Kerberoasting Focus)**
        - Create a decoy SPN (e.g., `MSSQLSvc/BackupAdmin`). Alert immediately if `ServiceName` matches this decoy.
    - **Strategy B: The "Ghost" TGS Correlation (Golden Ticket Focus)**
        - **Logic:** In a legitimate flow, a TGS request (4769) MUST be preceded by a TGT request (AS-REQ, Event 4768).
        - **Indicator:** Detect instances of Event 4769 where no corresponding Event 4768 exists for that `TargetUserName` and `IpAddress` within the standard TGT lifetime. This proves the TGT was forged offline.
    - **Strategy C: Ticket Anomaly & Encryption Downgrade**
        - Filter out machine accounts (`ServiceName != *$`) and alert on `TicketEncryptionType=0x17` combined with `TicketOptions=0x40810000`.
        - Monitor for unusual `End Time` values (e.g., 10-year lifetimes).
    - **Strategy D: S4U Delegation Monitoring (KCD Focus)**
        - Monitor for high volumes of TGS requests where the `ServiceName` indicates protocol transition (S4U) from service accounts to high-privileged targets.
        - **Cross-Event Correlation:** Correlate with Event 4624 where `Transited Services` is populated to identify the source of impersonation.
* **Reference:** 
    - [8.2.06_Kerberos_Protocol_and_Encryption](../08_Underlying_Principles/8.2_Active_Directory/8.2.06_Kerberos_Protocol_and_Encryption.md)
    - [8.2.11_Kerberos_Golden_Ticket_Mechanics](../08_Underlying_Principles/8.2_Active_Directory/8.2.11_Kerberos_Golden_Ticket_Mechanics.md)
    - [8.2.12_Kerberos_Delegation_Mechanics](../08_Underlying_Principles/8.2_Active_Directory/8.2.12_Kerberos_Delegation_Mechanics.md)

### Authentication Event Relationship Matrix

| Protocol | Action | Recording Location | Success ID | Failure ID | Key Identifier / Error Code |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **NTLM** | Credential Validation | **DC** (Domain) / **Local** | 4776 (0x0) | 4776 (Non-zero) | Source Workstation, Error Code |
| **NTLM** | Network Logon Result | **Target Endpoint** | 4624 (Type 3) | 4625 | Source Network Address, SubStatus |
| **Kerberos** | TGT Request (AS) | **DC** | 4768 | 4771 | Pre-auth Type, Status (0x18) |
| **Kerberos** | Service Ticket (TGS) | **DC** | 4769 | 4769 (Failure) | Service Name (SPN), Ticket Options |
| **Kerberos** | Network Logon Result | **Target Endpoint** | 4624 (Type 3) | 4625 (Rare*) | Source IP, Logon Type |
| **Management**| Account Status Change | **DC / Local** | 4722 (Enabled) | 4725 (Disabled) | SubjectUserSid (The Actor) |
| **Management**| Account Lockout | **DC** | 4740 | - | TargetUserName, Calling Computer |

*\*Note: In Kerberos flows, if pre-authentication fails (4771) at the DC, the target endpoint typically does not generate a 4625 unless it is an Interactive Logon (Type 2).*

---

## Category 3: System & Service Operations

*Purpose: Catching state changes that allow code to run automatically (Persistence) or with higher privileges.*

### Event 4698: A Scheduled Task Was Created

* **Priority:** High Impact / Medium Frequency
* **Adversary Intent:** Persistence (TA0003) / Execution (TA0002).
* **Key Fields to Analyze:**
    - TaskName: Often obscured or mimics Windows tasks.
    - TaskContent (XML): The most important field. It contains the <Command> (what runs) and <Arguments> (flags).
* **Detection Logic (Pattern Analysis):**
    - Suspicious Command: Task XML contains powershell, cmd, rundll32, or regsvr32.
    - Temp Execution: Task executes a binary from \AppData\Local\Temp.
* **Reference:** [1.5_Forensics_Artifacts_Map](./1.5_Forensics_Artifacts_Map.csv) (Correlate with disk artifacts in C:\Windows\System32\Tasks).

### Event 7045: A Service Was Installed
* **Priority:** Critical Impact / Low Frequency
* **Adversary Intent:** Persistence (TA0003) / Privilege Escalation (TA0004). Attackers install services to ensure malware survives reboot or runs as SYSTEM.
* **Key Fields to Analyze:**
    - ServiceName: Name of the service. (Look for random strings like Xyza.exe or mimicry like WindowsUpdateHelper).
    - ImagePath: The binary path. CRITICAL: Look for paths in writable user directories (\Temp, \Users, \ProgramData) instead of System32.
    - ServiceType: Kernel Mode Driver implies a Rootkit; User Mode Service implies standard malware.
* **Detection Logic:**
    - Path Anomaly: ImagePath contains "Temp" OR "AppData" OR "PerfLogs".
    - Masquerading: ServiceName mimics a legitimate service but runs from a non-standard path.
* **Reference:** [1.2_Windows_Process_Genealogy](./1.2_Windows_Process_Genealogy.csv) (Verify if services.exe behavior matches).

### Event 4672: Special Privileges Assigned to New Logon

* **Priority:** Medium Impact / High Frequency (Contextual)
* **Adversary Intent:** Privilege Escalation (TA0004). This event tells you "Did they become God?"
* **Key Fields to Analyze:**
    - SubjectUserName: The account that logged in.
    - PrivilegeList: The specific powers granted.
    - Standard Admin Privs: SeSecurityPrivilege, SeBackupPrivilege.
    - Dangerous Privs (HUNT HERE):
        - SeDebugPrivilege: Allows dumping memory (e.g., extracting passwords from LSASS).
        - SeTcbPrivilege: Act as part of the operating system.
        - SeLoadDriverPrivilege: Ability to load kernel drivers (BYOVD attacks).
* **Detection Logic:**
    - The "God Mode" Check: Ignore the standard noise from System/Machine accounts. Review the PrivilegeList field specifically for SeDebugPrivilege and SeLoadDriverPrivilege.
    - Contextual Pivot: Once a suspicious user is found here, immediately cross-reference their Session ID (LogonID) with Event 4624 to identify the source IP address.

### Sysmon Event 13: Registry Value Set

* **Priority:** High Impact / Medium Frequency
* **Adversary Intent:** Persistence (TA0003) / Defense Evasion (TA0005).
    - Fileless Malware: Storing the *payload* (Shellcode/Script) inside a registry key to avoid file scanning (AV/EDR).
    - Persistence: Adding a new entry to `CurrentVersion\Run` or `RunOnce`.
* **Key Fields to Analyze:**
    - TargetObject: The registry key path.
        - *Persistence:* `\Software\Microsoft\Windows\CurrentVersion\Run`
        - *Fileless Storage:* Often obscure keys like `\Software\Classes\CLSID\{GUID}` or purely random keys in `HKCU`.
    - Details (CRITICAL): The actual data being written.
    - Image: The process performing the write (e.g., `powershell.exe` writing to Registry is suspicious).
* **Detection Logic (Pattern Analysis):**
    - **Data Size and Entropy Anomalies:**
        - Legitimate registry values are typically short configuration strings or small integer types (DWORD/QWORD).
        - Indicator: Identify registry write events where the `Details` field contains a large volume of data (e.g., >1KB). If the data exhibits high entropy (randomness indicative of encrypted/compressed content) or contains executable file headers (e.g., hex starting with `4D 5A`), it likely represents a stored binary payload or shellcode.
    - Script Engine and Obfuscation Artifacts:
        - Even if the payload is encoded, the execution method often requires specific script engine arguments.
        - Indicator: Inspect the `Details` field for strings associated with script execution wrappers, such as `powershell`, `-enc` (Base64 encoded command), `javascript`, `vbscript`, `rundll32`, or `mshta`.
    - Binary Header Mismatch:
        - Indicator: Detect instances where binary executable data (identified by the `MZ` header) is written to registry keys that are not designed to store binary blobs (e.g., `HKCU` or `HKCR` configuration keys), regardless of the registry value name.
* **Reference:** [1.5_Forensics_Artifacts_Map](../01_Hunting_Cheatsheets/1.5_Forensics_Artifacts_Map.csv) (Compare with native Autoruns artifacts).

---

## Category 4: Network Operations

*Purpose: Identifying Lateral Movement & Data Staging.*

### Event 5142: A Network Share Object Was Added

* **Priority:** High Impact / Low Frequency
* **Adversary Intent:** Lateral Movement (TA0008) / Collection (TA0009). Attackers create new shares to move malware between hosts or to stage sensitive data before exfiltration.
* **Key Fields to Analyze:**
    - SubjectUserName: Who created the share? (Suspicious if it's not a Service Account or Admin).
    - Share Name: Is it a hidden share (ending in $)?
    - Share Path: Where does the share point to? (e.g., C:\Users\Public or C:\Windows\Temp).
* **Detection Logic:**
    - Baseline Anomaly: Alert on any 5142 generated on non-File Server hosts (e.g., Finance or HR workstations).
    - Flag any 5142 event where the `Share Path` points to OS-critical or data-sensitive directories.
        - **System Root:** `C:\Windows`, `C:\Windows\System32`, `C:\Windows\SysWOW64`.
        -  **Root Drives:** `C:\` (Creating a new share for the entire system drive is highly anomalous).
        - **User Staging:** `C:\Users\<User>\Documents`, `C:\Users\Public`.
        - **Web Servers:** `C:\inetpub\wwwroot` (Potential web shell deployment or source code theft).
        - **Temporary/Common Staging:** `C:\Temp`, `C:\Windows\Temp`, `C:\ProgramData`.
    - Command Line Correlation: Pivot to Event 4688 using SubjectLogonId to find the process that ran net share or New-SmbShare.

---

## Category 5: File & Object Operations

### Event 4656 & 4663: The Object Access Chain

* **Priority:** Medium Impact / Forensic Support (P2)
* **Adversary Intent:** Collection (TA0009) / Credential Access (TA0006). Records the lifecycle of an interaction with a System Object (File, Registry, or Process).
* **Key Fields to Analyze:**
    - **Object Type:** Identifies if the target is a File, Key, or Process.
    - **Access Mask:** Decodes the "Verb" (e.g., `0x1` = ReadData, `0x2` = WriteData, `0x10` = ReadControl).
    - **Handle ID:** The unique session token used to correlate the request (4656) with the actual operation (4663).
* **Detection Logic:**
    - **Handle Correlation:** Do not alert on 4656 alone; use the `Handle ID` to pivot and find the corresponding 4663 to confirm successful access.
    - **Cross-Category Pivot:** Use the `SubjectLogonId` to link these object operations back to the original `4624` Logon event to identify the source IP.

| Hex Code | Permission Name | Security Significance |
| :--- | :--- | :--- |
| **0x1** | **ReadData** | **High**. Actual file content was accessed. Essential for credential theft confirmation. |
| **0x80** | **ReadAttributes** | **Low**. Metadata (size, timestamp) was queried. Highly noisy; triggered by file browsing or script checks. |
| **0x10000** | **Delete** | **High**. The object was deleted. Often used in defense evasion or ransomware. |

**Hunting Tip**: When hunting for GPP password theft, filter for `AccessMask = 0x1` to reduce noise from routine system attribute checks (`0x80`).

### Event ID 4662: An Operation was Performed on an Object
- **Category**: Object Access (Directory Services)
- **Description**: Triggered when an operation is performed on an Active Directory object. While this is a high-volume event, it is the primary log for auditing access to sensitive AD objects, attribute changes, and the exercise of Extended Rights.
- **Critical Fields**:
    - `ObjectType`: The class of the object accessed (e.g., `domainDNS` for domain-level operations).
    - `AccessMask`: The type of access requested. `0x100` (Control Access) is often seen in sensitive operations.
    - `Properties`: The most critical field. It contains GUIDs representing the specific attributes or Extended Rights involved in the operation.
    - `SubjectUserName`: The account performing the action.
- **Hunting Logic**:
    - **DCSync Detection**: Monitor for `AccessMask="0x100"` and `Properties` containing the Replication GUIDs where `SubjectUserName` is not a known Domain Controller ($).
        - **Critical GUIDs**:
            - `1131f6aa-9c07-11d1-f79f-00c04fc2dcd2` (DS-Replication-Get-Changes)
            - `1131f6ad-9c07-11d1-f79f-00c04fc2dcd2` (DS-Replication-Get-Changes-All)
    - **LAPS Password Retrieval**: Monitor for specific GUIDs related to the `ms-Mcs-AdmPwd` attribute to find unauthorized LAPS password viewing.
    - **Sensitive ACL Changes**: Track modifications to AdminSDHolder or domain root objects by filtering for write-related Access Masks.

### Sysmon Event 11: FileCreate
* **Priority:** P0: Critical (Execution / Defense Evasion)
* **Adversary Intent:** Defense Evasion (TA0005) via Data Manipulation (T1565.001). Attackers modify Group Policy Template (GPT) files in `SYSVOL` (e.g., `GptTmpl.inf` or scripts) to deploy malware or persist across the domain.
* **Key Fields to Analyze:**
    - **TargetFilename**: Monitor for paths containing `\Windows\SYSVOL\domain\Policies\*`.
    - **Image**: The process responsible for the file creation/modification.
* **Technical Observation:** File creation in protected directories by unusual processes. For GPO specifically, any non-DC process writing to the Policies path should be treated as a critical incident.
* **Reference:** [8.2.08 GPO Delegation and Abuse Logic](../08_Underlying_Principles/8.2_Active_Directory/8.2.08_GPO_Delegation_and_Abuse_Logic.md)

---

## Appendix: Detection Priority Matrix

*Purpose: To standardize the classification of Event IDs based on their operational impact and observation frequency during an investigation.*

### 1. Classification Framework

| Priority Level | Impact (Severity) | Frequency (Visibility) | Description & Logic |
| :--- | :--- | :--- | :--- |
| **P0: Critical** | **High** | **High** | **Core Detection Pipeline.** Events that record the primary actions of an adversary (Execution, Auth). Mandatory for baseline monitoring. |
| **P1: Warning** | **High** | **Low** | **Defense Evasion / Integrity.** Events indicating tampering with security controls or auditing policy changes (e.g., Event 4907). |
| **P2: Informational** | **Medium** | **Varies** | **Forensic Support.** Supplemental logs used for deep-dive root cause analysis and reconstructing specific object access history. |

### 2. Priority Determination Workflow

To maintain consistency when adding new Event IDs, evaluate them against these three criteria:

1.  **Choke Point Analysis:** Is this event part of an adversary's mandatory path (e.g., Process Start)? 
    * *Yes* -> **High Impact**.
2.  **Noise Floor Evaluation:** Does this event generate millions of logs daily under normal conditions (e.g., File Read)? 
    * *Yes* -> **Medium/High Frequency**.
3.  **Adversarial Focus:** Is this event typically generated when an attacker tries to hide their tracks? 
    * *Yes* -> **P1: Warning (Low Frequency)**.
